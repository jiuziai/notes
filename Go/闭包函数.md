# 闭包函数
> Go语言是使用包（package）来组织管理源代码及命名空间的。
> 字面意思理解，闭包即是封闭的包，将整个包运行环境作为一个整体引用，而非包那样可单独引用包环境中的单个公开函数或变量。
> 故，闭包可以理解为一个单一功能精简化的包（package），可集成在函数体内。
> 闭包函数在Golang中应用非常广泛，无论是计数器、中间件、并发执行等……都主要使用闭包实现。
---
## 匿名函数
说闭包，必然离不开匿名函数，虽不是必须，但主流写法均return匿名函数，return匿名函数更能体现高内聚低耦合。  
匿名函数，即没有命名的函数，故只能声明的时候执行一次。
若要多次执行匿名函数，则须将匿名函数赋值到变量（可全局，可局部）中，通过变量再次执行匿名函数。
- 一次性匿名函数  
```go
package main

func main() {
	func(a int, b int) int {
		return a + b
	}(1, 2) // （1，2）的作用为直接调用前面的匿名函数
}

```
- 赋值变量的匿名函数  
```go
package main

func main() {
    // 将匿名函数赋值到变量f中
	f := func(a int, b int) int {
		return a + b
	}
    // 通过变量f调用前面的匿名函数
	f(1, 2)
}

```
- 需要主要的是，将匿名函数赋值到变量中时，如果跟参数输入，则变量被赋值的不是匿名函数，而是匿名函数执行的结果。
```go
package main

func main() {
    // 此时f被赋值的不是匿名函数，而是 int（3）
	f := func(a int, b int) int {
		return a + b
	}(1, 2)
}

```
---
## 闭包函数
闭包函数一般包括了匿名函数及匿名函数运行所需的环境。
```go
package main

func timer() func() int {
	t := 0
	return func() int {
		t++
		return t
	}
}
func main() {
	ter := timer()
	println(ter(), ter(), ter(), ter(), ter())
}
// 输出为：1 2 3 4 5
```
---
## 总结
有人理解为，闭包函数返回的并非一个函数，而是一个包含函数及函数运行环境的结构体。
即，```ter := timer()```是将```timer```匿名函数结构体赋值给```ter```，```ter()```则是调用该结构体中的方法。  
但是实际上，<em><b>闭包函数返回的就是一个函数</b></em>。只不过go的编译器拥有逃逸分析技术（Escape Analyze），可以自动识别变量的作用域，智能的决定将变量分配在栈中还是堆上，这是实现闭包函数的技术前提。